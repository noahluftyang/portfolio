# Migration `20200602191744-0002-media`

This migration has been generated by Euihyun Yang at 6/2/2020, 7:17:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."media" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"deleted_at" timestamp(3)   ,"id" SERIAL,"is_comment_enabled" boolean  NOT NULL ,"like_count" integer  NOT NULL ,"owner_id" integer  NOT NULL ,"thumbnail_url" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL ,"url" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."replies" (
"author_id" integer  NOT NULL ,"comment_id" integer  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"deleted_at" timestamp(3)   ,"hidden" boolean  NOT NULL ,"id" SERIAL,"like_count" integer  NOT NULL ,"text" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."comments" DROP CONSTRAINT IF EXiSTS "comments_post_id_fkey",
DROP COLUMN "body",
DROP COLUMN "post_id",
ADD COLUMN "hidden" boolean  NOT NULL ,
ADD COLUMN "like_count" integer  NOT NULL ,
ADD COLUMN "media_id" integer  NOT NULL ,
ADD COLUMN "text" text  NOT NULL ;

ALTER TABLE "public"."users" DROP COLUMN "password",
ADD COLUMN "password" text  NOT NULL ;

ALTER TABLE "public"."posts" DROP CONSTRAINT IF EXiSTS "posts_author_id_fkey";

ALTER TABLE "public"."media" ADD FOREIGN KEY ("owner_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."replies" ADD FOREIGN KEY ("author_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."replies" ADD FOREIGN KEY ("comment_id")REFERENCES "public"."comments"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."comments" ADD FOREIGN KEY ("media_id")REFERENCES "public"."media"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."posts";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200531111109-0001-initial..20200602191744-0002-media
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URI")
 }
 generator client {
   provider = "prisma-client-js"
@@ -12,41 +12,64 @@
 model User {
   id        Int       @id @default(autoincrement())
   email     String    @unique
-  password  String?
+  password  String
   username  String?
   createdAt DateTime  @map("created_at") @default(now())
   updatedAt DateTime  @map("updated_at") @updatedAt
   deletedAt DateTime? @map("deleted_at")
+  media     Media[]   @relation("user_media")
   comments  Comment[] @relation("user_comments")
-  posts     Post[]    @relation("user_posts")
+  replies   Reply[]   @relation("user_replies")
   @@map("users")
 }
-model Post {
+model Media {
+  id               Int       @id @default(autoincrement())
+  url              String
+  thumbnailUrl     String    @map("thumbnail_url")
+  likeCount        Int       @map("like_count")
+  ownerId          Int       @map("owner_id")
+  owner            User      @relation("user_media", fields: [ownerId], references: [id])
+  isCommentEnabled Boolean   @map("is_comment_enabled")
+  createdAt        DateTime  @map("created_at") @default(now())
+  updatedAt        DateTime  @map("updated_at") @updatedAt
+  deletedAt        DateTime? @map("deleted_at")
+  comments         Comment[] @relation("media_comments")
+
+  @@map("media")
+}
+
+model Comment {
   id        Int       @id @default(autoincrement())
-  title     String
+  text      String
+  likeCount Int       @map("like_count")
+  hidden    Boolean
   authorId  Int       @map("author_id")
-  author    User      @relation("user_posts", fields: [authorId], references: [id])
+  author    User      @relation("user_comments", fields: [authorId], references: [id])
+  mediaId   Int       @map("media_id")
+  media     Media     @relation("media_comments", fields: [mediaId], references: [id])
   createdAt DateTime  @map("created_at") @default(now())
   updatedAt DateTime  @map("updated_at") @updatedAt
   deletedAt DateTime? @map("deleted_at")
-  comments  Comment[] @relation("post_comments")
+  replies   Reply[]   @relation("comment_replies")
-  @@map("posts")
+  @@map("comments")
 }
-model Comment {
+model Reply {
   id        Int       @id @default(autoincrement())
-  body      String
+  text      String
+  likeCount Int       @map("like_count")
+  hidden    Boolean
   authorId  Int       @map("author_id")
-  author    User      @relation("user_comments", fields: [authorId], references: [id])
-  postId    Int       @map("post_id")
-  post      Post      @relation("post_comments", fields: [postId], references: [id])
+  author    User      @relation("user_replies", fields: [authorId], references: [id])
+  commentId Int       @map("comment_id")
+  comment   Comment   @relation("comment_replies", fields: [commentId], references: [id])
   createdAt DateTime  @map("created_at") @default(now())
   updatedAt DateTime  @map("updated_at") @updatedAt
   deletedAt DateTime? @map("deleted_at")
-  @@map("comments")
+  @@map("replies")
 }
```


