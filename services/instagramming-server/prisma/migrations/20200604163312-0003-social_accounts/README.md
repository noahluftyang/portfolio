# Migration `20200604163312-0003-social_accounts`

This migration has been generated by Euihyun Yang at 6/4/2020, 4:33:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Provider" AS ENUM ('FACEBOOK', 'GOOGLE');

CREATE TABLE "public"."social_accounts" (
"id" text  NOT NULL ,"provider" "Provider" NOT NULL ,"userId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."follows" (
"follower_id" integer  NOT NULL ,"following_id" integer  NOT NULL ,
    PRIMARY KEY ("follower_id","following_id"))

ALTER TABLE "public"."social_accounts" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."follows" ADD FOREIGN KEY ("follower_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."follows" ADD FOREIGN KEY ("following_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200602191744-0002-media..20200604163312-0003-social_accounts
--- datamodel.dml
+++ datamodel.dml
@@ -2,30 +2,57 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URI")
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id        Int       @id @default(autoincrement())
-  email     String    @unique
-  password  String
-  username  String?
-  createdAt DateTime  @map("created_at") @default(now())
-  updatedAt DateTime  @map("updated_at") @updatedAt
-  deletedAt DateTime? @map("deleted_at")
-  media     Media[]   @relation("user_media")
-  comments  Comment[] @relation("user_comments")
-  replies   Reply[]   @relation("user_replies")
+  id             Int             @id @default(autoincrement())
+  email          String          @unique
+  password       String
+  username       String?
+  createdAt      DateTime        @map("created_at") @default(now())
+  updatedAt      DateTime        @map("updated_at") @updatedAt
+  deletedAt      DateTime?       @map("deleted_at")
+  socialAccounts SocialAccount[] @relation("user_social_accounts")
+  followers      Follow[]        @relation("user_followers")
+  following      Follow[]        @relation("user_following")
+  media          Media[]         @relation("user_media")
+  comments       Comment[]       @relation("user_comments")
+  replies        Reply[]         @relation("user_replies")
   @@map("users")
 }
+model SocialAccount {
+  id       String   @id
+  userId   Int
+  user     User     @relation("user_social_accounts", fields: [userId], references: [id])
+  provider Provider
+
+  @@map("social_accounts")
+}
+
+enum Provider {
+  FACEBOOK
+  GOOGLE
+}
+
+model Follow {
+  followerId  Int  @map("follower_id")
+  follower    User @relation("user_followers", fields: [followerId], references: [id])
+  followingId Int  @map("following_id")
+  following   User @relation("user_following", fields: [followingId], references: [id])
+
+  @@id([followerId, followingId])
+  @@map("follows")
+}
+
 model Media {
   id               Int       @id @default(autoincrement())
   url              String
   thumbnailUrl     String    @map("thumbnail_url")
```


